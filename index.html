<!DOCTYPE html>
<html>
  <head>
    <title>20 שאלות</title>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="elm.js"></script>
  </head>
  <body>
    <script>
      var app = Elm.Main.init();

      app.ports.fetchStoredScores.subscribe(function() {
        var dict = JSON.parse(window.localStorage.getItem("storedScores"));
        app.ports.onStoredScoresFetch.send(dict);
      });

      app.ports.storeScore.subscribe(function(params) {
        var quizId = params[0];
        var questionIndex = params[1];
        var score = params[2];
        var dict = JSON.parse(window.localStorage.getItem("storedScores"));
        if (!dict) {
          dict = {};
        }
        if (!dict[quizId]) {
          dict[quizId] = [];
        }
        dict[quizId][questionIndex] = score;
        window.localStorage.setItem("storedScores", JSON.stringify(dict));
      });

      app.ports.clearStorage.subscribe(function() {
        window.localStorage.setItem("storedScores", null);
      });
    </script>
  </body>
</html>
